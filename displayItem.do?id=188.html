<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <p><a id="logo" href="http://scala-lang.org/"><img src="/sites/default/files/icons/Scala_Logo2008.png" alt="scala-lang.org" border=0/></a></p>
    <title id="Title">Aladdin - Scala Bugtracking</title>
        <style type="text/css">
        table {
            font-size: 10pt;
            background-color: #ebb85c;
        }
        tr.impair        { background-color: #f0be64 }
        tr.impairContrib { background-color: #f0be64 }

#buraq-content {
	float: none;
	color: black;
	background-color: white;
	font-size: 1.25em;
	margin-left: 9.6em;
}
        </style>
      </head>
  <body><!--DisplayBugsBlock_Start-->




<table WIDTH="100%" cellspacing="4" cellpadding="2">

	<tr><td></td>
		<th>[#188]</th>
		<th><strong>project:</strong> compiler</th>
		<th><strong>priority:</strong> low</th>
		<th><strong>category:</strong> bug</th>
        </tr>

        <tr>
          <td></td>
	  <th align="center">submitter</th>
	  <th align="center">assigned to</th>
	  <th align="center">status</th>
	  <th align="center">date submitted</th>
        </tr>

        <tr>
          <td></td>
	  <td align="center" bgcolor="#FFFFFF">Matthias</td>
	  <td align="center" bgcolor="#FFFFFF">Burak</td>
	  <td align="center" bgcolor="#FFFFFF">fixed</td>
          <td align="center" bgcolor="#FFFFFF">2003-10-07 11:11:32.0</td>

	</tr>

        <tr>
		<th align="right">subject</th>
		<td colspan="4" bgcolor="#FFFFFF">Incorrect behavior of pattern matcher</td>
	</tr>
	<tr>	
		<th align="right">code</th>
		<td colspan="4" bgcolor="#FFFFFF">
	<font size="-1"><pre>case class One()
case class Two(x: Any)

object Main extends Object with Application {
  def test(xs: List[Any]) = xs match {
    case List(((Two(One()) | Two(Two(_))), One()) | (Two(_), Two(_))) =&gt;
    	Console.println(&quot;case&quot;);
    case List(p) if !p.isInstanceOf[Tuple2[A,B] forSome { type A; type B }]=&gt;
    	Console.println(&quot;broken test program, we want to test pairs here.&quot;);
    case _ =&gt;
    	Console.println(&quot;default&quot;);
  }

  val p1 = (One(), One())
  test(List(p1));
  val p2 = (One(), Two(One()))
  test(List(p2));
  val p3 = (Two(One()), One());
  test(List(p3))
  val p4 = (Two(One()), Two(One()))
  test(List(p4));
}
</pre></font></td>
	</tr>
	<tr>
		<th style="text-align:right;">what happened</th>
		<td colspan="4" style="background-color:#FFFFFF;" ><pre>Method <code>foo</code>'s first case is supposed to match all Lists of length two whose first element is Two(*) \
and whose second element is either Two(*) or One() (where * refers to either One() or Two(*) objects). Unfortuna\
tely, the code generated by the compiler doesn't detect
sequences of the form: List(Two(*), Two(*)). Here's the output:
<pre>
default
default
case
default
</pre>
</pre></td>
	</tr>
	<tr>
		<th align="right">what expected</th>
		<td colspan="4" bgcolor="#FFFFFF" >The expected output is:
<pre>
default
default
case
case
</pre></td>
	</tr>
	<tr>
	
  <td colspan="4" align="right">
      
      <a href="displayBugs.do.html">
        [back to overview]</a></td></tr>

</table>

  <tr>
          <td align="center" colspan="2">
            <strong>Changes of this bug report</strong>
          </td>
        </tr><table><tr>
        <td>
        <strong>Burak&nbsp; edited on &nbsp;2004-10-06 16:16:42.0</strong>
        </td>
        </tr>
<tr><td bgcolor='#FFFFFF'>
[changed "with Executable" to "with Application"]<br/>

Although this particular instance works, there are still  nondeterministic regular expressions that are not treated correctly.
</td></tr>
<tr>
        <td>
        <strong>Matthias&nbsp; edited on &nbsp;2004-10-12 10:11:26.0</strong>
        </td>
        </tr>
<tr><td bgcolor='#FFFFFF'>
I think the fix pushes the capability of the pattern matcher only one more level. Adding a new alternative to the first pattern exposes exactly the same problem. Here's the code:
<pre>
case class One();
case class Two(x: Any);
object Main with Application {
  def test(xs: List[Any]) = xs match {
    case List(((Two(One()) | Two(Two(_))), One()) |
              (Two(_), Two(One())) |
              (Two(_), Two(Two(_)))) =>
        Console.println("case");
    case _ =>
        Console.println("default");
  }
  test(List(One(), One()));
  test(List(One(), Two(One())));
  test(List(Two(One()), One()));
  test(List(Two(One()), Two(One())));
  test(List(Two(One()), Two(Two(One()))));
}
</pre>
This code should produce the following output:
<pre>
default
default
case
case
case
</pre>
But currently, it yields <code>default</code> for the last call to test.
</td></tr>
<tr>
        <td>
        <strong>Lex&nbsp; edited on &nbsp;2006-03-28 13:31:44.0</strong>
        </td>
        </tr>
<tr><td bgcolor='#FFFFFF'>
I have adde "extends Object".  Nevertheless, this pattern does not even compile.  Should it?

</td></tr>
<tr>
        <td>
        <strong>Burak&nbsp; edited on &nbsp;2007-07-06 11:40:48.0</strong>
        </td>
        </tr>
<tr><td bgcolor='#FFFFFF'>
I change this test program, in the years past since it was originally submitted, it has come to mean something slightly different. It used to test regexps on lists, but now it tests pairs and alternative patterns (and works). 

</td></tr></table>
<!--DisplayBugsBlock_End-->  </body>
</html>